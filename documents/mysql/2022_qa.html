<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.45">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>2022 MySQL Q&A | DongXianZhang</title><meta name="description" content="Welcome to DongXianZhang Site">
    <link rel="modulepreload" href="/assets/app.d2ac80f5.js"><link rel="modulepreload" href="/assets/2022_qa.html.9c3f9366.js"><link rel="modulepreload" href="/assets/2022_qa.html.59b09df1.js"><link rel="prefetch" href="/assets/index.html.09669752.js"><link rel="prefetch" href="/assets/hello.html.947b3903.js"><link rel="prefetch" href="/assets/2022_oppo_qa.html.99adf571.js"><link rel="prefetch" href="/assets/brain_into_submission.html.eff7fd34.js"><link rel="prefetch" href="/assets/index.html.1ab62b18.js"><link rel="prefetch" href="/assets/2022_learn-go-kratos.html.200ec213.js"><link rel="prefetch" href="/assets/index.html.99d6bebd.js"><link rel="prefetch" href="/assets/2022_qa.html.290bb7d8.js"><link rel="prefetch" href="/assets/index.html.4238011f.js"><link rel="prefetch" href="/assets/quick_start_command.html.323dc1b7.js"><link rel="prefetch" href="/assets/2022_learn.html.8b57768e.js"><link rel="prefetch" href="/assets/index.html.e6df5284.js"><link rel="prefetch" href="/assets/slow_query_qa.html.a703c3b1.js"><link rel="prefetch" href="/assets/2022_learn.html.48e63e9b.js"><link rel="prefetch" href="/assets/2022_qa.html.517b47ea.js"><link rel="prefetch" href="/assets/index.html.27f37248.js"><link rel="prefetch" href="/assets/404.html.f166316b.js"><link rel="prefetch" href="/assets/index.html.e8986708.js"><link rel="prefetch" href="/assets/hello.html.716a482e.js"><link rel="prefetch" href="/assets/2022_oppo_qa.html.5d420339.js"><link rel="prefetch" href="/assets/brain_into_submission.html.d7a6b0d5.js"><link rel="prefetch" href="/assets/index.html.e5818b4c.js"><link rel="prefetch" href="/assets/2022_learn-go-kratos.html.6889949c.js"><link rel="prefetch" href="/assets/index.html.ba5118af.js"><link rel="prefetch" href="/assets/2022_qa.html.d66f474a.js"><link rel="prefetch" href="/assets/index.html.aaefbbe7.js"><link rel="prefetch" href="/assets/quick_start_command.html.e9a026f2.js"><link rel="prefetch" href="/assets/2022_learn.html.1ad17158.js"><link rel="prefetch" href="/assets/index.html.dd672c17.js"><link rel="prefetch" href="/assets/slow_query_qa.html.c948e987.js"><link rel="prefetch" href="/assets/2022_learn.html.72f3ccd5.js"><link rel="prefetch" href="/assets/2022_qa.html.fc8309f9.js"><link rel="prefetch" href="/assets/index.html.8213e7dd.js"><link rel="prefetch" href="/assets/404.html.a27babe0.js"><link rel="prefetch" href="/assets/404.011fe4b9.js"><link rel="prefetch" href="/assets/Layout.7802f1c5.js">
    <link rel="stylesheet" href="/assets/style.e04b053e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">DongXianZhang</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Documents"><span class="title">Documents</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Documents"><span class="title">Documents</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/documents/article/index.md" class="" aria-label="Article"><!--[--><!--]--> Article <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/documents/go/index.md" class="" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/documents/php/index.md" class="" aria-label="PHP"><!--[--><!--]--> PHP <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/documents/mysql/index.md" class="router-link-active" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/documents/linux/index.md" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Documents"><span class="title">Documents</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Documents"><span class="title">Documents</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/documents/article/index.md" class="" aria-label="Article"><!--[--><!--]--> Article <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/documents/go/index.md" class="" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/documents/php/index.md" class="" aria-label="PHP"><!--[--><!--]--> PHP <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/documents/mysql/index.md" class="router-link-active" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/documents/linux/index.md" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Article <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/documents/article/" class="sidebar-item" aria-label="说明"><!--[--><!--]--> 说明 <!--[--><!--]--></a><!----></li><li><a href="/documents/article/brain_into_submission.html" class="sidebar-item" aria-label="让大脑屈服"><!--[--><!--]--> 让大脑屈服 <!--[--><!--]--></a><!----></li><li><a href="/documents/article/2022_oppo_qa.html" class="sidebar-item" aria-label="oppo后端面试题"><!--[--><!--]--> oppo后端面试题 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Go <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/documents/go/" class="sidebar-item" aria-label="Go简介"><!--[--><!--]--> Go简介 <!--[--><!--]--></a><!----></li><li><a href="/documents/go/2022_learn-go-kratos.html" class="sidebar-item" aria-label="学习go-kratos"><!--[--><!--]--> 学习go-kratos <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">PHP <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/documents/php/" class="sidebar-item" aria-label="PHP简介"><!--[--><!--]--> PHP简介 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">MySQL <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/documents/mysql/" class="router-link-active sidebar-item" aria-label="MySQL简介"><!--[--><!--]--> MySQL简介 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/documents/mysql/2022_qa.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="2022 MySQL Q&amp;A"><!--[--><!--]--> 2022 MySQL Q&amp;A <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/documents/mysql/2022_qa.html#mysql索引" class="router-link-active router-link-exact-active sidebar-item" aria-label="MySQL索引"><!--[--><!--]--> MySQL索引 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/documents/mysql/2022_qa.html#索引使用什么数据结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="索引使用什么数据结构？"><!--[--><!--]--> 索引使用什么数据结构？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/documents/mysql/2022_qa.html#为什么使用b-树做索引" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么使用B+树做索引？"><!--[--><!--]--> 为什么使用B+树做索引？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/documents/mysql/2022_qa.html#什么是最左匹配原则" class="router-link-active router-link-exact-active sidebar-item" aria-label="什么是最左匹配原则?"><!--[--><!--]--> 什么是最左匹配原则? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/documents/mysql/2022_qa.html#建表的时候如何设计索引" class="router-link-active router-link-exact-active sidebar-item" aria-label="建表的时候如何设计索引？"><!--[--><!--]--> 建表的时候如何设计索引？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/documents/mysql/2022_qa.html#优化查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="优化查询"><!--[--><!--]--> 优化查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/documents/mysql/2022_qa.html#主从同步" class="router-link-active router-link-exact-active sidebar-item" aria-label="主从同步"><!--[--><!--]--> 主从同步 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/documents/mysql/slow_query_qa.html" class="sidebar-item" aria-label="慢查询原因"><!--[--><!--]--> 慢查询原因 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Linux <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/documents/linux/" class="sidebar-item" aria-label="简介"><!--[--><!--]--> 简介 <!--[--><!--]--></a><!----></li><li><a href="/documents/linux/2022_qa.html" class="sidebar-item" aria-label="测试题"><!--[--><!--]--> 测试题 <!--[--><!--]--></a><!----></li><li><a href="/documents/linux/quick_start_command.html" class="sidebar-item" aria-label="一、快速上手几个命令"><!--[--><!--]--> 一、快速上手几个命令 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="_2022-mysql-q-a" tabindex="-1"><a class="header-anchor" href="#_2022-mysql-q-a" aria-hidden="true">#</a> 2022 MySQL Q&amp;A</h1><h2 id="mysql索引" tabindex="-1"><a class="header-anchor" href="#mysql索引" aria-hidden="true">#</a> MySQL索引</h2><h3 id="索引使用什么数据结构" tabindex="-1"><a class="header-anchor" href="#索引使用什么数据结构" aria-hidden="true">#</a> 索引使用什么数据结构？</h3><p>MySQL默认使用引擎是InnoDB，此引擎的索引使用的数据结构是B+树。</p><h3 id="为什么使用b-树做索引" tabindex="-1"><a class="header-anchor" href="#为什么使用b-树做索引" aria-hidden="true">#</a> 为什么使用B+树做索引？</h3><p>如果使用Hash，在区间查找上，无法使用索引；<br> 如果使用其他二叉树，当数据量大的时候，会出现树很高，不利于查找，因为索引查询需要访问磁盘，会进行磁盘I/O，树越高，进行磁盘I/O次数就会多。<br> B+树经常用来比较的是B树</p><ol><li>B+树所有关键字都会出现在叶子节点；</li><li>B+树的数据值是存储在叶子节点，非叶子节点不存储数据值，所以B+树在找到关键字后并不会停止查找，还需要继续向下查找到叶子节点获得数据值；</li><li>B+树的非叶子节点存储的关键字比B树要多；</li></ol><h3 id="什么是最左匹配原则" tabindex="-1"><a class="header-anchor" href="#什么是最左匹配原则" aria-hidden="true">#</a> 什么是最左匹配原则?</h3><p>最左前缀匹配原则：在MySQL简历联合索引时会遵守最左前缀匹配原则，即最左优先，在检索数据时从联合索引的最左边开始匹配。</p><p>例如：有张product表，我们根据商户id➕商品分类id建立了一个联合索引index_shop_id_cate_id(shop_id, cate_id)两个字段组成。<br> 索引先根据shop_id排序，在根据cate_id排序，如果后面还有字段，继续以此类推。<br> 当where条件如果只有分类id，是不会走联合索引的，但如果是有商户id，是可能会走联合索引的。（当数据库数据量很少时，可能直接全表遍历会更快，数据库就选择不走索引了）</p><h3 id="建表的时候如何设计索引" tabindex="-1"><a class="header-anchor" href="#建表的时候如何设计索引" aria-hidden="true">#</a> 建表的时候如何设计索引？</h3><blockquote><p>回表是指在非聚集索引中找到关键字后，还需要根据找到的数据值（聚集索引的关键字）到聚集索引里面查找数据。<br> 利用覆盖索引进行查询，避免回表查询。</p></blockquote><p>比如商品表的主键索引是id，查询商品的id，那写查询语句的时候，直接 <code>select id from product</code> 就可以，不用查询其他字段，尽量按需查询字段，少用或不用<code>*</code>，不然还需要回表。</p><h3 id="优化查询" tabindex="-1"><a class="header-anchor" href="#优化查询" aria-hidden="true">#</a> 优化查询</h3><ul><li>使用explain查看执行计划，看extra列的值，出现using index表示用到索引。</li><li>JOIN禁止超过三个表。</li><li>where或join的字段，数据类型保持绝对一只，不然数据库会进行隐式转换，导致索引无效；</li><li>索引列数据尽量设置not null。</li><li>对varchar建立索引时，没必要对全字段建立索引，根据实际文本区分度决定索引长度。</li><li>搜索严禁左模糊或全模糊。（最左匹配原则）。</li><li>SQL性能优化的目标：至少达到range级别，要求时ref级别，如果时const时最好的。 <ol><li>const：单表中最多只有一个匹配行。</li><li>ref：指的是使用普通索引。（normal index）</li><li>range：对索引进行范围检索。</li></ol></li><li>创建组合索引的时候，区分度最高的放最左边。</li><li>防止因字段类型不同造成的隐式转换，导致索引失效。</li></ul><h3 id="主从同步" tabindex="-1"><a class="header-anchor" href="#主从同步" aria-hidden="true">#</a> 主从同步</h3><ol><li>Master数据库只要发生变化，立马记录到Bin log日志文件中。</li><li>Slave数据库启动一个I/O thread链接Master数据库，请求Master变化的二进制日志。</li><li>Slave I/O获取到的二进制日志，保存到自己的Relay log日志文件中。</li><li>Slave有一个SQL thread定时检查Relay log是否有变化，变化那么就更新数据。</li></ol><p><img src="/images/mysql/master-slave.png" alt="流程"></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: dxzhangg@foxmail.com">dxzhangg</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/documents/mysql/" class="router-link-active" aria-label="MySQL简介"><!--[--><!--]--> MySQL简介 <!--[--><!--]--></a></span><span class="next"><a href="/documents/mysql/slow_query_qa.html" class="" aria-label="慢查询原因"><!--[--><!--]--> 慢查询原因 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.d2ac80f5.js" defer></script>
  </body>
</html>
